<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head th:with="layoutTitle='질문 상세 - 질문 관리 시스템'">
    <link rel="stylesheet" th:href="@{/static/css/question/detail.css}">
</head>
<body>
<div layout:fragment="content">
    <div class="page-header">
        <h2>질문 상세</h2>
        <a th:href="@{/questions}" class="btn btn-text">
            <i class="fas fa-arrow-left"></i> 목록으로 돌아가기
        </a>
    </div>

    <!-- 메인 수정 폼 -->
    <form th:action="@{/questions/{id}(id=${question.serialNumber})}" method="post" th:object="${question}" id="questionForm">
        <div class="question-detail-container">
            <div class="detail-header">
                <div class="serial-badge" th:text="${question.serialNumber}">Q0001</div>
                <!-- hidden 필드로 serial number 유지 -->
                <input type="hidden" th:field="*{serialNumber}" />
                <!-- isPublic 값을 저장하는 히든 필드 추가 -->
                <input type="hidden" th:field="*{isPublic}" id="isPublicField" />
                
				<!-- 공개 상태 토글 버튼 -->
				<div class="detail-actions">
				    <!-- 비공개로 전환 폼 (현재 공개 상태일 때) -->
				    <form th:if="${question.isPublic == 'yes'}" 
				          th:action="@{/questions/{id}/public(id=${question.serialNumber})}" 
				          method="post" 
				          style="display: inline;">
				        <input type="hidden" name="isPublic" value="no" />
				        <button type="submit" class="btn btn-toggle btn-danger">
				            <i class="fas fa-eye-slash" id="toggleIcon"></i>
				            <span id="toggleText">비공개로 전환</span>
				        </button>
				    </form>
				     
				    <!-- 공개로 전환 폼 (현재 비공개 상태일 때) -->
				    <form th:if="${question.isPublic == 'no'}" 
				          th:action="@{/questions/{id}/public(id=${question.serialNumber})}" 
				          method="post" 
				          style="display: inline;">
				        <input type="hidden" name="isPublic" value="yes" />
				        <button type="submit" class="btn btn-toggle btn-success">
				            <i class="fas fa-eye" id="toggleIcon"></i>
				            <span id="toggleText">공개로 전환</span>
				        </button>
				    </form>
				</div>
            </div>
            
            <!-- 질문 부분을 편집 가능한 textarea로 변경 -->
            <div class="question-content">
                <h3>질문</h3>
                <textarea class="content-box" th:field="*{question}" rows="3" required></textarea>
            </div>
            
            <!-- 보기 부분을 편집 가능한 input으로 변경 -->
            <div class="options-grid">
                <div class="option-box">
                    <div class="option-label">보기 1</div>
                    <input type="text" class="option-content" th:field="*{option1}" required />
                </div>
                <div class="option-box">
                    <div class="option-label">보기 2</div>
                    <input type="text" class="option-content" th:field="*{option2}" required />
                </div>
                <div class="option-box">
                    <div class="option-label">보기 3</div>
                    <input type="text" class="option-content" th:field="*{option3}" required />
                </div>
                <div class="option-box">
                    <div class="option-label">보기 4</div>
                    <input type="text" class="option-content" th:field="*{option4}" required />
                </div>
            </div>
            
            <div class="detail-footer">
                <div class="creation-date">
                    <i class="fas fa-calendar"></i>
                    생성일: <span th:text="${#temporals.format(question.createdAt, 'yyyy년 MM월 dd일 HH:mm')}">
                        2025년 05월 14일 15:30
                    </span>
                </div>
                
                <!-- 저장 버튼 추가 -->
                <div class="form-actions" style="margin-top: 20px; text-align: right;">
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        <i class="fas fa-save"></i> 저장하기
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<th:block layout:fragment="scripts">
    <script th:src="@{/static/js/question/detail.js}"></script>
</th:block>
</body>
</html>
<!-- 윈도우 95/98 스타일 사이드바 HTML -->
<!-- fragments/sidebar.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
</head>

<body>
    <!-- 다른 페이지에 포함될 사이드바 조각 -->
    <div th:fragment="sidebar" class="sidebar-component">
        <div class="sidebar">
            <!-- 로고 영역 -->
            <div class="sidebar-logo">
                <a th:href="@{/}">
                    <div class="menu-icon">
                        <img src="/img/icons/computer.png" alt="mogatshoo" class="logo-img">
                    </div>
                    <div class="logo-text">탈모왕중왕</div>
                </a>
            </div>
            
            <!-- 메뉴 아이템 -->
            <div class="sidebar-menu">
                <div class="menu-item">
                    <a class="nav-link" th:href="@{/}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="홈">
                        </div>
                        <span class="menu-text">홈</span>
                    </a>
                </div>
                <div class="menu-item">
                    <a class="nav-link" th:href="@{/fortune/start}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="운세">
                        </div>
                        <span class="menu-text">오늘운세</span>
                    </a>
                </div>
                <div class="menu-item">
                    <a class="nav-link" th:href="@{/hairLossTest/testHair}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="탈모진단">
                        </div>
                        <span class="menu-text">탈모진단</span>
                    </a>
                </div>
                <div class="menu-item">
                    <a class="nav-link" th:href="@{/hospitalMap/hospitals}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="병원지도">
                        </div>
                        <span class="menu-text">병원지도</span>
                    </a>
                </div>
            </div>
            
            <!-- 로그인 상태에 따른 메뉴 -->
            <!-- 비로그인 상태일 때 표시되는 링크 -->
            <div class="sidebar-auth" sec:authorize="isAnonymous()">
                <div class="auth-item">
                    <a class="nav-link" th:href="@{/member/login}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="로그인">
                        </div>
                        <span class="menu-text">로그인</span>
                    </a>
                </div>
                <div class="auth-item">
                    <a class="nav-link" th:href="@{/member/join}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="회원가입">
                        </div>
                        <span class="menu-text">회원가입</span>
                    </a>
                </div>
            </div>

            <!-- 로그인 상태일 때 표시되는 내용 -->
            <div class="sidebar-auth" sec:authorize="isAuthenticated()">
                <div class="auth-profile">
                    <a th:href="@{/member/mypage(memberId=${#authentication.name})}" class="nav-link">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="마이페이지">
                        </div>
                        <span class="menu-text" th:text="${#authentication.principal.nickName}"></span>
                    </a>
                </div>
                <div class="auth-item">
                    <a class="nav-link" th:href="@{/point/list(memberId=${#authentication.name})}">
                        <div class="menu-icon">
                            <img src="/img/icons/computer.png" alt="포인트">
                        </div>
                        <span class="menu-text">포인트</span>
                    </a>
                </div>
                <div class="auth-item">
                    <form th:action="@{/logout}" method="post" class="logout-form">
                        <button type="submit" class="logout-btn">
                            <div class="menu-icon">
                                <img src="/img/icons/computer.png" alt="로그아웃">
                            </div>
                            <span class="menu-text">로그아웃</span>
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- 토글 버튼 (모바일 뷰에서만 보임) -->
            <div class="sidebar-toggle">
                <button id="sidebarToggleBtn">
                    <span class="toggle-icon">☰</span>
                </button>
            </div>
        </div>
		
		<!-- 윈도우95 창 템플릿 -->
		   <div id="win95Window" class="win95-window">
		       <div class="win95-title-bar">
		           <div class="win95-title-text">문서</div>
		           <div class="win95-close">×</div>
		       </div>
		       <div class="win95-content">
		           <!-- 여기에 Ajax로 로드된 내용이 들어갑니다 -->
		           <div id="windowContent">로딩 중...</div>
		       </div>
		   </div>
		
		<!-- jQuery 사용 (간편한 Ajax 처리를 위해) -->
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

		<script>
		    $(document).ready(function() {
		        // 사이드바 항목 클릭 시
		        $('.menu-item a').click(function(e) {
		            e.preventDefault();
		            
		            // 파일 정보 가져오기
		            const file = $(this).data('file');
		            const title = $(this).data('title') || '문서';
		            
		            // 제목 설정
		            $('.win95-title-text').text(title);
		            
		            // Ajax로 내용 로드
		            $('#windowContent').html('로딩 중...');
		            
		            $.ajax({
		                url: file,
		                success: function(data) {
		                    // 내용 삽입
		                    $('#windowContent').html(data);
		                    
		                    // 창 표시
		                    $('#win95Window').show();
		                },
		                error: function() {
		                    $('#windowContent').html('파일을 로드할 수 없습니다.');
		                    $('#win95Window').show();
		                }
		            });
		        });
		        
		        // 닫기 버튼 클릭 시
		        $('.win95-close').click(function() {
		            $('#win95Window').hide();
		        });
		        
		        // 드래그 기능 (간단 구현)
		        let isDragging = false;
		        let offsetX, offsetY;
		        
		        $('.win95-title-bar').mousedown(function(e) {
		            isDragging = true;
		            offsetX = e.clientX - $('#win95Window').position().left;
		            offsetY = e.clientY - $('#win95Window').position().top;
		            
		            $(document).mousemove(function(e) {
		                if (isDragging) {
		                    $('#win95Window').css({
		                        left: e.clientX - offsetX,
		                        top: e.clientY - offsetY,
		                        transform: 'none'
		                    });
		                }
		            });
		            
		            $(document).mouseup(function() {
		                isDragging = false;
		                $(document).off('mousemove');
		                $(document).off('mouseup');
		            });
		        });
		    });
		</script>
    </div>
</body>

</html>